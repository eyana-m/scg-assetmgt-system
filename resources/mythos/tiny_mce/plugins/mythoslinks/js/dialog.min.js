function get_selected_link(){var a=tinymce.activeEditor;return a.dom.getParent(a.selection.getNode(),"A")}function select_current_link(a){var b=function(){if(a!=null){a()}};var c=get_selected_link();tinymce.activeEditor.selection.select(c);if(c!=null&&c.getAttribute("href")!=""){var d=c.getAttribute("href");var e=d.replace("{SITE_URL}","");if(e.length<d.length){$("#link_type").val("int");select_link_type();$.get(RELATIVE_PATH+"api/pages/get_by_slug/"+e,function(a){if(a.pag_id==null){$("#pages").val(0);b()}else{$("#page_cats").val(a.pct_id);get_pages(function(){$("#pages").val(a.pag_slug);b()})}})}else{$("#link_type").val("ext");select_link_type();$("#ext_url").val(d)}}else{b()}}function get_page_cats(a){var b=$("#page_cats");b.find("option").remove();$.get(RELATIVE_PATH+"api/page_categories/get_all",function(c){b.append($("<option />").val(0).text("Uncategorized"));for(var d=0;d<c.length;d++){b.append($("<option />").val(c[d].pct_id).text(c[d].pct_name))}if(a!=null){a()}},"json")}function get_pages(a){var b=$("#page_cats");var c=b.val();var d=$("#pages");d.find("option").remove();$.get(RELATIVE_PATH+"api/pages/get_of_category/"+c,function(b){for(var c=0;c<b.length;c++){d.append($("<option />").val(b[c].pag_slug).text(b[c].pag_title))}if(a!=null){a()}},"json")}function select_link_type(){var a=$("#link_type").val();if(a=="int"){$("#fg_ext").hide();$("#fg_int").show()}else if(a=="ext"){$("#fg_int").hide();$("#fg_ext").show()}}var RELATIVE_PATH="../../../../../";$(function(){$("#link_type").change(function(){select_link_type()});$("#insert_link").click(function(){var a=tinymce.activeEditor;var b=$("#pages");var c=$("#link_type").val();var d="";if(c=="int"){d="{SITE_URL}"+b.val()}else if(c=="ext"){d=$("#ext_url").val()}a.selection.setContent('<a href="'+d+'">'+a.selection.getContent()+"</a>");self.close()});$("#back_link").click(function(){self.close()});get_page_cats(function(){select_current_link(function(){$("#page_cats").change(function(){get_pages()});window.resizeTo(450,350)})});select_link_type()})